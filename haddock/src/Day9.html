<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module:         Day9
Description:    &lt;https://adventofcode.com/2021/day/9 Day 9: Smoke Basin&gt;
-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Day9</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Day9.html#day9a"><span class="hs-identifier">day9a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Day9.html#day9b"><span class="hs-identifier">day9b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">digitToInt</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isDigit</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph.Inductive</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Gr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">buildGr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">components</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapAccumL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapAccumR</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipWith5</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Down</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lines</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unpack</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="annot"><a href="Day9.html#day9a"><span class="hs-identifier hs-type">day9a</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-17"></span><span id="day9a"><span class="annot"><span class="annottext">day9a :: Text -&gt; Int
</span><a href="Day9.html#day9a"><span class="hs-identifier hs-var hs-var">day9a</span></a></span></span><span> </span><span id="local-6989586621679083733"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679083733"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679083731"><span class="hs-identifier hs-var">risks</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-18"></span><span>    </span><span id="local-6989586621679083730"><span class="annot"><span class="annottext">heights :: [String]
</span><a href="#local-6989586621679083730"><span class="hs-identifier hs-var hs-var">heights</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; [Text] -&gt; [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.lines</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679083733"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span id="local-6989586621679083731"><span class="annot"><span class="annottext">risks :: [Int]
</span><a href="#local-6989586621679083731"><span class="hs-identifier hs-var hs-var">risks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Int]] -&gt; [Int]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Int]] -&gt; [Int]) -&gt; [[Int]] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String -&gt; String -&gt; [Int])
-&gt; [String] -&gt; [String] -&gt; [String] -&gt; [[Int]]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><span class="hs-identifier hs-var">zipWith3</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; [Int]
</span><a href="#local-6989586621679083726"><span class="hs-identifier hs-var">basins</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679083730"><span class="hs-identifier hs-var">heights</span></a></span><span>
</span><span id="line-20"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; String
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Char
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679083730"><span class="hs-identifier hs-var">heights</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [String] -&gt; [String]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679083730"><span class="hs-identifier hs-var">heights</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char -&gt; String
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Char
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>    </span><span id="local-6989586621679083726"><span class="annot"><span class="annottext">basins :: String -&gt; String -&gt; String -&gt; [Int]
</span><a href="#local-6989586621679083726"><span class="hs-identifier hs-var hs-var">basins</span></a></span></span><span> </span><span id="local-6989586621679083722"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083722"><span class="hs-identifier hs-var">row</span></a></span></span><span> </span><span id="local-6989586621679083721"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083721"><span class="hs-identifier hs-var">above</span></a></span></span><span> </span><span id="local-6989586621679083720"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083720"><span class="hs-identifier hs-var">below</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe Int] -&gt; [Int]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe Int] -&gt; [Int]) -&gt; [Maybe Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char -&gt; Char -&gt; Char -&gt; Char -&gt; Maybe Int)
-&gt; String -&gt; String -&gt; String -&gt; String -&gt; String -&gt; [Maybe Int]
forall a b c d e f.
(a -&gt; b -&gt; c -&gt; d -&gt; e -&gt; f)
-&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d] -&gt; [e] -&gt; [f]
</span><span class="hs-identifier hs-var">zipWith5</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Char -&gt; Char -&gt; Char -&gt; Maybe Int
</span><a href="#local-6989586621679083719"><span class="hs-identifier hs-var">basin</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083722"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083721"><span class="hs-identifier hs-var">above</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083720"><span class="hs-identifier hs-var">below</span></a></span><span>
</span><span id="line-22"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083722"><span class="hs-identifier hs-var">row</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String -&gt; String
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083722"><span class="hs-identifier hs-var">row</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Char
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span id="local-6989586621679083719"><span class="annot"><span class="annottext">basin :: Char -&gt; Char -&gt; Char -&gt; Char -&gt; Char -&gt; Maybe Int
</span><a href="#local-6989586621679083719"><span class="hs-identifier hs-var hs-var">basin</span></a></span></span><span> </span><span id="local-6989586621679083718"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679083717"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083717"><span class="hs-identifier hs-var">above</span></a></span></span><span> </span><span id="local-6989586621679083716"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083716"><span class="hs-identifier hs-var">below</span></a></span></span><span> </span><span id="local-6989586621679083715"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083715"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621679083714"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083714"><span class="hs-identifier hs-var">right</span></a></span></span><span>
</span><span id="line-24"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083717"><span class="hs-identifier hs-var">above</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083716"><span class="hs-identifier hs-var">below</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083715"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083714"><span class="hs-identifier hs-var">right</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe Int) -&gt; Int -&gt; Maybe Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">digitToInt</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-25"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="annot"><a href="Day9.html#day9b"><span class="hs-identifier hs-type">day9b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-28"></span><span id="day9b"><span class="annot"><span class="annottext">day9b :: Text -&gt; Int
</span><a href="Day9.html#day9b"><span class="hs-identifier hs-var hs-var">day9b</span></a></span></span><span> </span><span id="local-6989586621679083711"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679083711"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">product</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Down Int) -&gt; [Int] -&gt; [Int]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Down Int
forall a. a -&gt; Down a
</span><span class="hs-identifier hs-var">Down</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [[Int]] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([[Int]] -&gt; [Int]) -&gt; [[Int]] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Gr () () -&gt; [[Int]]
forall (gr :: * -&gt; * -&gt; *) a b. Graph gr =&gt; gr a b -&gt; [[Int]]
</span><span class="hs-identifier hs-var">components</span></span><span> </span><span class="annot"><span class="annottext">Gr () ()
</span><a href="#local-6989586621679083707"><span class="hs-identifier hs-var">basins</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>    </span><span id="local-6989586621679083707"><span class="annot"><span class="annottext">basins :: Gr () ()
</span><a href="#local-6989586621679083707"><span class="hs-identifier hs-var hs-var">basins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. DynGraph Gr =&gt; [Context a b] -&gt; Gr a b
forall (gr :: * -&gt; * -&gt; *) a b.
DynGraph gr =&gt;
[Context a b] -&gt; gr a b
</span><span class="hs-identifier hs-var">buildGr</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Gr</span></span><span> </span><span class="annot"><span class="annottext">([Context () ()] -&gt; Gr () ()) -&gt; [Context () ()] -&gt; Gr () ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[Context () ()]] -&gt; [Context () ()]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Context () ()]] -&gt; [Context () ()])
-&gt; [[Context () ()]] -&gt; [Context () ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, [Maybe Int]), [[Context () ()]]) -&gt; [[Context () ()]]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(((Int, [Maybe Int]), [[Context () ()]]) -&gt; [[Context () ()]])
-&gt; ((Int, [Maybe Int]), [[Context () ()]]) -&gt; [[Context () ()]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, [Maybe Int])
 -&gt; String -&gt; ((Int, [Maybe Int]), [Context () ()]))
-&gt; (Int, [Maybe Int])
-&gt; [String]
-&gt; ((Int, [Maybe Int]), [[Context () ()]])
forall (t :: * -&gt; *) a b c.
Traversable t =&gt;
(a -&gt; b -&gt; (a, c)) -&gt; a -&gt; t b -&gt; (a, t c)
</span><span class="hs-identifier hs-var">mapAccumR</span></span><span> </span><span class="annot"><span class="annottext">(Int, [Maybe Int])
-&gt; String -&gt; ((Int, [Maybe Int]), [Context () ()])
forall a a.
Num a =&gt;
(a, [Maybe a])
-&gt; String -&gt; ((a, [Maybe a]), [([((), a)], a, (), [a])])
</span><a href="#local-6989586621679083706"><span class="hs-identifier hs-var">mkRow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; ((Int, [Maybe Int]), [[Context () ()]]))
-&gt; [String] -&gt; ((Int, [Maybe Int]), [[Context () ()]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; [Text] -&gt; [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.lines</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679083711"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span id="local-6989586621679083706"><span class="annot"><span class="annottext">mkRow :: (a, [Maybe a])
-&gt; String -&gt; ((a, [Maybe a]), [([((), a)], a, (), [a])])
</span><a href="#local-6989586621679083706"><span class="hs-identifier hs-var hs-var">mkRow</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679083705"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083705"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083704"><span class="annot"><span class="annottext">[Maybe a]
</span><a href="#local-6989586621679083704"><span class="hs-identifier hs-var">prev</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083703"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083703"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, [Maybe a])
</span><a href="#local-6989586621679083702"><span class="hs-identifier hs-var">next</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[([((), a)], a, (), [a])]
forall a. [([((), a)], a, (), [a])]
</span><a href="#local-6989586621679083701"><span class="hs-identifier hs-var">contexts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-31"></span><span>        </span><span id="local-6989586621679083702"><span class="annot"><span class="annottext">next :: (a, [Maybe a])
</span><a href="#local-6989586621679083702"><span class="hs-identifier hs-var">next</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679083700"><span class="annot"><span class="annottext">[Maybe a]
</span><a href="#local-6989586621679083700"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Char -&gt; (a, Maybe a)) -&gt; a -&gt; String -&gt; (a, [Maybe a])
forall (t :: * -&gt; *) a b c.
Traversable t =&gt;
(a -&gt; b -&gt; (a, c)) -&gt; a -&gt; t b -&gt; (a, t c)
</span><span class="hs-identifier hs-var">mapAccumL</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Char -&gt; (a, Maybe a)
forall a. Num a =&gt; a -&gt; Char -&gt; (a, Maybe a)
</span><a href="#local-6989586621679083699"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083705"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679083703"><span class="hs-identifier hs-var">line</span></a></span><span>
</span><span id="line-32"></span><span>        </span><span id="local-6989586621679083699"><span class="annot"><span class="annottext">f :: a -&gt; Char -&gt; (a, Maybe a)
</span><a href="#local-6989586621679083699"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679083698"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083698"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679083697"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083697"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083697"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">digitToInt</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679083697"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083698"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083698"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>        </span><span class="annot"><a href="#local-6989586621679083699"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span id="local-6989586621679083696"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083696"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679083696"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>        </span><span id="local-6989586621679083701"><span class="annot"><span class="annottext">contexts :: [([((), a)], a, (), [a])]
</span><a href="#local-6989586621679083701"><span class="hs-identifier hs-var hs-var">contexts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe ([((), a)], a, (), [a])] -&gt; [([((), a)], a, (), [a])]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe ([((), a)], a, (), [a])] -&gt; [([((), a)], a, (), [a])])
-&gt; [Maybe ([((), a)], a, (), [a])] -&gt; [([((), a)], a, (), [a])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; Maybe a -&gt; Maybe a -&gt; Maybe ([((), a)], a, (), [a]))
-&gt; [Maybe a]
-&gt; [Maybe a]
-&gt; [Maybe a]
-&gt; [Maybe ([((), a)], a, (), [a])]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><span class="hs-identifier hs-var">zipWith3</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Maybe a -&gt; Maybe a -&gt; Maybe ([((), a)], a, (), [a])
forall b b a.
Maybe b -&gt; Maybe b -&gt; Maybe b -&gt; Maybe ([((), b)], b, (), [a])
</span><a href="#local-6989586621679083695"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe a]
</span><a href="#local-6989586621679083700"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe a]
</span><a href="#local-6989586621679083704"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe a] -&gt; [Maybe a] -&gt; [Maybe a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; [Maybe a]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Maybe a] -&gt; [Maybe a]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Maybe a]
</span><a href="#local-6989586621679083700"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe a] -&gt; [Maybe a] -&gt; [Maybe a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; [Maybe a]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>        </span><span id="local-6989586621679083695"><span class="annot"><span class="annottext">g :: Maybe b -&gt; Maybe b -&gt; Maybe b -&gt; Maybe ([((), b)], b, (), [a])
</span><a href="#local-6989586621679083695"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679083694"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083694"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679083693"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679083693"><span class="hs-identifier hs-var">above'</span></a></span></span><span> </span><span id="local-6989586621679083692"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679083692"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-36"></span><span>            </span><span class="annot"><span class="annottext">([((), b)], b, (), [a]) -&gt; Maybe ([((), b)], b, (), [a])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083691"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679083691"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083691"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe b] -&gt; [b]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679083693"><span class="hs-identifier hs-var">above'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679083692"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679083694"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="#local-6989586621679083695"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([((), b)], b, (), [a])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-38"></span></pre></body></html>